import{b as g,_ as W}from"./bns.24e95b72.js";import{r as i,a as Y,o,b as c,e,t as k,u as n,F as D,f as H,h as v,i as ee,j as R,y as te,w as S,c as ae,k as m,v as _,l as le,m as I,q as se,s as ne,p as oe}from"./entry.d8bcef15.js";import{A as ce,_ as de}from"./ardb.bec4bd6a.js";const re={class:"flex flex-col"},ie={class:"menu bg-base-100 flex flex-col menu-horizontal"},ue={class:"min-w-[6rem] py-2"},pe={key:0,class:"bg-base-100 min-w-[6rem] fixed z-50 mt-[35px] top-auto py-0 border-l border-r border-b border-black"},me={key:0,class:"border-t border-black"},_e=["onClick"],he={__name:"SelectorCompact",props:["variants","selectedVariantKey","label"],emits:["update:selected"],setup(E,{expose:l,emit:u}){const T=E,y=i(T.variants),w=i(null),N=i(!0),x=i(T.selectedVariantKey);let A=Y(()=>T.variants.find(d=>d.key==x.value));function V(d){x.value=d,w.value.blur(),N.value=!1,ee(()=>{setTimeout(()=>{N.value=!0},100)}),u("update:selected",x)}return l({select:V}),(d,B)=>(o(),c("div",re,[e("ul",ie,[e("li",{tabindex:"0",class:"focus:",ref_key:"selectorRoot",ref:w},[e("span",ue,k(n(A).name),1),n(N)?(o(),c("ul",pe,[(o(!0),c(D,null,H(n(y),p=>(o(),c(D,{key:p.key},[p.key!=n(x)?(o(),c("li",me,[e("a",{onClick:U=>V(p.key),class:"py-2"},k(p.name),9,_e)])):v("",!0)],64))),128))])):v("",!0)],512)])]))}},ve={key:1,class:"h-full w-full flex flex-col items-center justify-center"},fe={class:"text-2xl mt-4"},be={class:"bg-neutral lg:min-w-1/2 xl:min-w-1/4 min-w-3/4 p-4 mt-4 flex flex-col items-center justify-center"},ye={class:"form-control"},we=e("label",{class:"label"},[e("span",{class:"label-text"},"Edit name of domain")],-1),xe={class:"input-group"},ge={class:"overflow-x-auto w-max"},ke={class:"label"},Te={class:"label-text"},Ne={class:"table w-full table-compact"},Ae=e("thead",null,[e("tr",null,[e("th",{class:"bg-black"},"Name"),e("th",{class:"bg-black"},"Record")])],-1),Se=e("th",null,"NS1",-1),Ve=e("th",null,"NS2",-1),Ue={class:"overflow-x-auto w-min"},Ce=e("label",{class:"label"},[e("span",{class:"label-text"},"Edit DNS records")],-1),Me={class:"table w-full"},Re=e("thead",null,[e("tr",null,[e("th",{class:"bg-black"},"Type"),e("th",{class:"bg-black"},"Name"),e("th",{class:"bg-black"},"Content"),e("th",{class:"bg-black"},[e("p",null,"TTL (seconds)")]),e("th",{class:"bg-black"})])],-1),De={class:"p-0"},Ee=["onUpdate:modelValue"],Be={class:""},Xe=["onUpdate:modelValue"],je=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],He=["onUpdate:modelValue"],Ke=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],Oe=["onUpdate:modelValue"],Ze={class:""},Fe=["onClick"],Pe=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),ze=[Pe],qe=e("label",{class:"label label-text text-center w-full justify-center mt-4"},"Don't forget to press save button or your edits will be lost",-1),We={__name:"manage",async setup(E){var j;let l,u;const T=R("arweave",()=>{ce.init({host:"arweave.net",port:443,protocol:"https",timeout:6e4,logging:!1})}),y=i(!1),w=T.value,N=R("ardb",()=>new de(w.value));let x=R("wallet",()=>null).value,A=N.value,V=te(),d=i([]),B=i([{key:"A",name:"A"},{key:"TXT",name:"TXT"},{key:"CNAME",name:"CNAME"},{key:"AAAA",name:"AAAA"},{key:"MX",name:"MX"},{key:"NS",name:"NS"}]),p=i(V.hash.slice(1)),U=i(BigInt("0x"+q(w.utils.b64UrlToBuffer(p.value))).toString(36)),K=i(([l,u]=S(()=>A.search("transaction").id(p.value).exclude("anchor").findOne()),l=await l,u(),l)),C=i(([l,u]=S(()=>fetch("https://arweave.net/"+p.value).then(t=>t.json())),l=await l,u(),l)),h=i((j=([l,u]=S(()=>A.search("transactions").sort("HEIGHT_DESC").from(C.value.managers).appName("Arweave-Nameserver").tags([{name:"Action",values:"UpdateName"},{name:"Manager-TX",values:[p.value]}]).exclude("anchor").limit(1).findOne()),l=await l,u(),l||K.value).tags.find(t=>t.name=="Domain-Name"))==null?void 0:j.value),X=([l,u]=S(()=>A.search("transactions").tags([{name:"Target-NS-TxID",values:[p.value]}]).from(C.value.managers).sort("HEIGHT_DESC").limit(1).exclude(["anchor"]).find()),l=await l,u(),l),L=X.length>0?X[0].id:C.value.recordsTx,O=([l,u]=S(()=>fetch("https://arweave.net/"+L).then(t=>t.text())),l=await l,u(),l),f=i(Object.fromEntries(Object.entries(g.constants.types).map(([t,r])=>[r,t])));async function Z(){let t=await w.createTransaction({data:"update"});t.addTag("Action","UpdateName"),t.addTag("App-Name","Arweave-Nameserver"),t.addTag("Manager-TX",p.value),t.addTag("Domain-Name",h.value),y.value=!0,await x.dispatch(t),y.value=!1}try{d.value=g.wire.fromZone(O,h.value),console.log(g),console.log(d.value)}catch(t){d.value=[],console.log("Error parsing zonefile:",t)}function F(t,r){d.value[t].type=g.constants.types[r]}function P(){let t=new g.wire.Record().fromJSON({name:h.value,ttl:300,data:{address:"111.111.111.111"},type:"A",class:"IN"});t.data.address="",d.value.push(t)}function z(t){d.value=d.value.filter((r,b)=>b!=t)}function q(t){return t.reduce((r,b)=>r+b.toString(16).padStart(2,"0"),"")}async function G(){y.value=!0;let t=await w.createTransaction({data:g.wire.toZone(d.value)});t.addTag("App-Name","Arweave-Nameserver"),t.addTag("Target-NS-TxID",p.value),t.addTag("Action","UpdateDNSRecords");let{id:r}=await x.dispatch(t),b="Not found.";for(;b=="Not found.";)b=await fetch(`https://arweave.net/${r}`).then(M=>M.text()),J(3e3);y.value=!1}function J(t){return new Promise(r=>setTimeout(r,t))}return(t,r)=>{const b=W,M=he,Q=ne;return n(y)?(o(),ae(b,{key:0})):(o(),c("div",ve,[e("h1",fe,"Manage "+k(n(h)),1),e("div",be,[e("div",ye,[we,e("div",xe,[m(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=a=>le(h)?h.value=a:h=a),placeholder:"Enter new name",class:"input input-bordered"},null,512),[[_,n(h)]]),e("button",{class:"btn btn-outline btn-square",onClick:Z}," Save ")])]),e("div",ge,[e("label",ke,[e("span",Te,"To make it work, you need to setup these NS records on "+k(n(h)),1)]),e("table",Ne,[Ae,e("tbody",null,[e("tr",null,[Se,e("td",null,k(n(U))+".winston",1)]),e("tr",null,[Ve,e("td",null,k(n(U))+"._arweave",1)])])])]),e("div",Ue,[Ce,e("table",Me,[Re,e("tbody",null,[(o(!0),c(D,null,H(n(d),(a,$)=>(o(),c("tr",null,[e("td",De,[I(M,{"onUpdate:selected":s=>F($,s),variants:n(B),ref_for:!0,ref:"typeSelector",selectedVariantKey:n(f)[a.type],label:"Record type"},null,8,["onUpdate:selected","variants","selectedVariantKey"])]),e("td",null,[m(e("input",{"onUpdate:modelValue":s=>a.name=s,placeholder:"Record subdomain",class:"input input-sm"},null,8,Ee),[[_,a.name]])]),e("td",Be,[n(f)[a.type]=="A"?m((o(),c("input",{key:0,"onUpdate:modelValue":s=>a.data.address=s,placeholder:"IP",class:"input input-sm"},null,8,Xe)),[[_,a.data.address]]):v("",!0),n(f)[a.type]=="TXT"?m((o(),c("textarea",{key:1,"onUpdate:modelValue":s=>a.data.txt[0]=s,class:"textarea h-0 p-2",placeholder:"Text content"},null,8,je)),[[_,a.data.txt[0]]]):v("",!0),n(f)[a.type]=="NS"?m((o(),c("input",{key:2,"onUpdate:modelValue":s=>a.data.ns=s,placeholder:"Nameserver",class:"input input-sm"},null,8,$e)),[[_,a.data.ns]]):v("",!0),n(f)[a.type]=="AAAA"?m((o(),c("input",{key:3,"onUpdate:modelValue":s=>a.data.address=s,placeholder:"IPv6",class:"input input-sm"},null,8,Ie)),[[_,a.data.address]]):v("",!0),n(f)[a.type]=="CNAME"?m((o(),c("input",{key:4,"onUpdate:modelValue":s=>a.data.target=s,placeholder:"CNAME Target",class:"input input-sm"},null,8,He)),[[_,a.data.target]]):v("",!0),n(f)[a.type]=="MX"?m((o(),c("input",{key:5,"onUpdate:modelValue":s=>a.data.mx=s,placeholder:"MX Server",class:"input input-sm"},null,8,Ke)),[[_,a.data.mx]]):v("",!0),n(f)[a.type]=="MX"?m((o(),c("input",{key:6,"onUpdate:modelValue":s=>a.data.priority=s,type:"number",placeholder:"MX Priority",class:"input input-sm"},null,8,Le)),[[_,a.data.priority]]):v("",!0)]),e("td",null,[m(e("input",{"onUpdate:modelValue":s=>a.ttl=s,type:"number",placeholder:"Seconds of record cache",class:"input input-sm w-20"},null,8,Oe),[[_,a.ttl]])]),e("td",Ze,[e("div",{class:"inline-flex cursor-pointer justify-center items-center",onClick:s=>z($)},ze,8,Fe)])]))),256))])]),qe,e("div",{class:"w-full flex justify-center flex-row"},[e("button",{class:"btn btn-secondary mx-2",onClick:P},"Add new record"),e("button",{class:"btn btn-accent mx-2",onClick:G},"Save records")])])]),I(Q,{class:"btn btn-outline flex mt-4",to:"/"},{default:se(()=>[oe("Back to management panel")]),_:1})]))}}};export{We as default};
